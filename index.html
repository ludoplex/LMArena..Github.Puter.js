<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMArena + GitHub Integration via Puter.js</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://js.puter.com/v2/"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #0d1117 0%, #161b22 50%, #21262d 100%);
        }
        .github-card {
            background: rgba(22, 27, 34, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid #30363d;
        }
        .lmarena-card {
            background: linear-gradient(135deg, rgba(88, 28, 135, 0.3) 0%, rgba(22, 27, 34, 0.8) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid #7c3aed;
        }
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes typing {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        .typing-indicator span {
            animation: typing 1.4s infinite;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        .repo-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        .scrollbar-dark::-webkit-scrollbar {
            width: 8px;
        }
        .scrollbar-dark::-webkit-scrollbar-track {
            background: #21262d;
        }
        .scrollbar-dark::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 4px;
        }
        .scrollbar-dark::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }
        .code-editor {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            tab-size: 4;
        }
        .glow-purple {
            box-shadow: 0 0 20px rgba(124, 58, 237, 0.3);
        }
        .ai-message {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.2) 0%, rgba(22, 27, 34, 0.8) 100%);
        }
        .user-message {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(22, 27, 34, 0.8) 100%);
        }
        .lmarena-iframe {
            border: 2px solid #7c3aed;
            border-radius: 12px;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-gray-100">
    <div id="app" class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <header class="flex items-center justify-between mb-8 flex-wrap gap-4">
            <div class="flex items-center gap-3">
                <div class="flex items-center gap-2">
                    <i class="fas fa-robot text-3xl text-purple-400"></i>
                    <i class="fas fa-plus text-gray-500"></i>
                    <i class="fab fa-github text-3xl"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold">LMArena + GitHub</h1>
                    <p class="text-gray-400 text-sm">AI Code Generation â†’ GitHub Push via Puter.js</p>
                </div>
            </div>
            <div id="authSection" class="flex gap-3 flex-wrap">
                <button id="githubSignInBtn" onclick="signInWithGitHub()" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded-lg font-medium transition flex items-center gap-2 border border-gray-600">
                    <i class="fab fa-github"></i> Sign in with GitHub
                </button>
            </div>
        </header>

        <!-- Connection Status -->
        <div id="statusBar" class="github-card rounded-lg p-4 mb-6 flex items-center justify-between flex-wrap gap-4">
            <div class="flex items-center gap-3">
                <div id="statusDot" class="w-3 h-3 rounded-full bg-yellow-500 pulse-dot"></div>
                <span id="statusText" class="text-gray-300">Ready to connect...</span>
            </div>
            <div class="flex items-center gap-4 text-sm">
                <div class="flex items-center gap-2">
                    <div id="puterDot" class="w-2 h-2 rounded-full bg-gray-500"></div>
                    <span class="text-gray-400">Puter</span>
                </div>
                <div class="flex items-center gap-2">
                    <div id="githubDot" class="w-2 h-2 rounded-full bg-gray-500"></div>
                    <span class="text-gray-400">GitHub</span>
                </div>
                <div class="flex items-center gap-2">
                    <div id="aiDot" class="w-2 h-2 rounded-full bg-green-500"></div>
                    <span class="text-gray-400">AI Ready</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div id="mainContent" class="hidden">
            <!-- User Profile Card -->
            <div id="userProfile" class="github-card rounded-xl p-6 mb-6">
                <div class="flex items-center gap-4 flex-wrap">
                    <img id="userAvatar" src="" alt="Avatar" class="w-16 h-16 rounded-full border-2 border-green-500">
                    <div class="flex-1 min-w-0">
                        <h2 id="userName" class="text-xl font-bold"></h2>
                        <p id="userLogin" class="text-gray-400"></p>
                        <p id="userBio" class="text-gray-300 text-sm mt-1 truncate"></p>
                    </div>
                    <div class="flex gap-6 text-center">
                        <div>
                            <div id="repoCount" class="text-2xl font-bold text-green-400">0</div>
                            <div class="text-gray-400 text-sm">Repos</div>
                        </div>
                        <div>
                            <div id="followerCount" class="text-2xl font-bold text-blue-400">0</div>
                            <div class="text-gray-400 text-sm">Followers</div>
                        </div>
                        <div>
                            <div id="followingCount" class="text-2xl font-bold text-purple-400">0</div>
                            <div class="text-gray-400 text-sm">Following</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="flex gap-2 mb-6 flex-wrap">
                <button onclick="switchTab('lmarena')" id="tabLmarena" class="tab-btn bg-purple-600 px-4 py-2 rounded-lg font-medium transition">
                    <i class="fas fa-robot mr-2"></i>AI Code Gen
                </button>
                <button onclick="switchTab('lmarenasite')" id="tabLmarenasite" class="tab-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg font-medium transition">
                    <i class="fas fa-globe mr-2"></i>LMArena.ai
                </button>
                <button onclick="switchTab('repos')" id="tabRepos" class="tab-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg font-medium transition">
                    <i class="fas fa-book mr-2"></i>Repositories
                </button>
                <button onclick="switchTab('create')" id="tabCreate" class="tab-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg font-medium transition">
                    <i class="fas fa-plus mr-2"></i>Create Repo
                </button>
            </div>

            <!-- AI Code Generation Tab -->
            <div id="lmarenaTab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- AI Chat Section -->
                    <div class="lmarena-card rounded-xl p-6 glow-purple">
                        <div class="flex items-center gap-3 mb-4">
                            <i class="fas fa-robot text-2xl text-purple-400"></i>
                            <h3 class="text-xl font-bold">AI Code Generator</h3>
                        </div>
                        
                        <!-- Model Selection -->
                        <div class="mb-4">
                            <label class="block text-gray-400 mb-2 text-sm">AI Model (via Puter.ai)</label>
                            <select id="aiModel" class="w-full bg-gray-800 border border-purple-600 rounded-lg px-4 py-2 focus:outline-none focus:border-purple-400">
                                <option value="gpt-4o">GPT-4o (OpenAI)</option>
                                <option value="claude-3-5-sonnet">Claude 3.5 Sonnet</option>
                                <option value="claude-3-opus">Claude 3 Opus</option>
                                <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                                <option value="meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo">Llama 3.1 70B</option>
                                <option value="mistral-large-latest">Mistral Large</option>
                            </select>
                        </div>

                        <!-- Chat Messages -->
                        <div id="chatMessages" class="h-64 overflow-y-auto scrollbar-dark mb-4 space-y-3 p-2">
                            <div class="ai-message rounded-lg p-3 border border-purple-700">
                                <div class="flex items-center gap-2 mb-2">
                                    <i class="fas fa-robot text-purple-400"></i>
                                    <span class="font-medium text-purple-300">AI Assistant</span>
                                </div>
                                <p class="text-gray-300 text-sm">Hello! I can generate code for you. Describe what you want to build, and I'll create the code. You can then push it to a new or existing GitHub repository!</p>
                            </div>
                        </div>

                        <!-- Prompt Input -->
                        <div class="flex gap-2">
                            <textarea id="aiPrompt" placeholder="Describe the code you want to generate..." 
                                class="flex-1 bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:border-purple-500 resize-none h-20"
                                onkeydown="if(event.key==='Enter' && !event.shiftKey){event.preventDefault();generateCode();}"></textarea>
                            <button onclick="generateCode()" id="generateBtn" class="bg-purple-600 hover:bg-purple-700 px-6 rounded-lg font-medium transition flex items-center gap-2">
                                <i class="fas fa-magic"></i>
                                <span>Generate</span>
                            </button>
                        </div>

                        <!-- Quick Prompts -->
                        <div class="mt-4">
                            <p class="text-gray-400 text-sm mb-2">Quick prompts:</p>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="setPrompt('Create a React todo app with add, delete, and complete functionality')" class="text-xs bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded-full transition">React Todo App</button>
                                <button onclick="setPrompt('Create a Python Flask REST API with CRUD operations for a blog')" class="text-xs bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded-full transition">Flask API</button>
                                <button onclick="setPrompt('Create a Node.js Express server with authentication using JWT')" class="text-xs bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded-full transition">Express + JWT</button>
                                <button onclick="setPrompt('Create a responsive landing page with Tailwind CSS')" class="text-xs bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded-full transition">Landing Page</button>
                            </div>
                        </div>
                    </div>

                    <!-- Code Output & Push Section -->
                    <div class="github-card rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-code text-2xl text-green-400"></i>
                                <h3 class="text-xl font-bold">Generated Code</h3>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="copyCode()" class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-sm transition">
                                    <i class="fas fa-copy mr-1"></i>Copy
                                </button>
                                <button onclick="clearCode()" class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-sm transition">
                                    <i class="fas fa-trash mr-1"></i>Clear
                                </button>
                            </div>
                        </div>

                        <!-- Filename Input -->
                        <div class="mb-3">
                            <input type="text" id="codeFilename" placeholder="filename.js" 
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:border-green-500 text-sm font-mono">
                        </div>

                        <!-- Code Editor -->
                        <textarea id="generatedCode" 
                            class="code-editor w-full h-64 bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 focus:outline-none focus:border-green-500 text-sm text-green-300 resize-none scrollbar-dark"
                            placeholder="// Generated code will appear here..."></textarea>

                        <!-- Push to GitHub Section -->
                        <div class="mt-4 p-4 bg-gray-800 rounded-lg border border-gray-700">
                            <h4 class="font-medium mb-3 flex items-center gap-2">
                                <i class="fab fa-github text-green-400"></i>
                                Push to GitHub
                            </h4>
                            
                            <!-- Option to create new repo -->
                            <div class="mb-3">
                                <label class="flex items-center gap-2 cursor-pointer mb-2">
                                    <input type="checkbox" id="createNewRepo" class="w-4 h-4 accent-green-500" onchange="toggleNewRepoSection()">
                                    <span class="text-sm">Create new repository</span>
                                </label>
                                <div id="newRepoSection" class="hidden mb-3 p-3 bg-gray-900 rounded border border-gray-600">
                                    <input type="text" id="newRepoNameForPush" placeholder="new-repo-name" 
                                        class="w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm mb-2 focus:outline-none focus:border-green-500">
                                    <input type="text" id="newRepoDescForPush" placeholder="Repository description (optional)" 
                                        class="w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm mb-2 focus:outline-none focus:border-green-500">
                                    <label class="flex items-center gap-2 cursor-pointer text-sm">
                                        <input type="checkbox" id="newRepoPrivateForPush" class="w-4 h-4 accent-green-500">
                                        <span>Private repository</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div id="existingRepoSection" class="grid grid-cols-2 gap-3 mb-3">
                                <div>
                                    <label class="block text-gray-400 text-xs mb-1">Repository</label>
                                    <select id="targetRepo" class="w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-green-500">
                                        <option value="">Select repository...</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-400 text-xs mb-1">Branch</label>
                                    <input type="text" id="targetBranch" value="main" 
                                        class="w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-green-500">
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="block text-gray-400 text-xs mb-1">File Path (e.g., src/)</label>
                                <input type="text" id="filePath" placeholder="src/" 
                                    class="w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-green-500">
                            </div>
                            
                            <div class="mb-3">
                                <label class="block text-gray-400 text-xs mb-1">Commit Message</label>
                                <input type="text" id="commitMessage" placeholder="Add generated code" 
                                    class="w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-green-500">
                            </div>

                            <button onclick="pushToGitHub()" id="pushBtn" class="w-full bg-green-600 hover:bg-green-700 py-2 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i class="fas fa-upload"></i>
                                Push to GitHub
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LMArena.ai Website Tab -->
            <div id="lmarenasiteTab" class="tab-content hidden">
                <div class="github-card rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4 flex-wrap gap-4">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-globe text-2xl text-purple-400"></i>
                            <h3 class="text-xl font-bold">LMArena.ai</h3>
                        </div>
                        <div class="flex gap-2">
                            <a href="https://lmarena.ai" target="_blank" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg text-sm transition flex items-center gap-2">
                                <i class="fas fa-external-link-alt"></i>Open in New Tab
                            </a>
                            <button onclick="captureFromLMArena()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg text-sm transition flex items-center gap-2">
                                <i class="fas fa-download"></i>Import Code
                            </button>
                        </div>
                    </div>
                    <p class="text-gray-400 text-sm mb-4">Use LMArena.ai to compare AI models and generate code. Copy the generated code and use the "Import Code" button or paste it directly in the AI Code Gen tab.</p>
                    
                    <!-- Code Import Section -->
                    <div class="mb-4 p-4 bg-gray-800 rounded-lg border border-purple-600">
                        <h4 class="font-medium mb-2 text-purple-300">Import Code from LMArena</h4>
                        <textarea id="lmarenaCodeImport" placeholder="Paste code from LMArena.ai here..." 
                            class="w-full h-32 bg-gray-900 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:border-purple-500 text-sm font-mono mb-2"></textarea>
                        <div class="flex gap-2">
                            <input type="text" id="lmarenaFilename" placeholder="filename.js" 
                                class="flex-1 bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500">
                            <button onclick="importLMArenaCode()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg text-sm transition">
                                <i class="fas fa-file-import mr-2"></i>Import to Editor
                            </button>
                        </div>
                    </div>
                    
                    <div class="lmarena-iframe bg-gray-900 rounded-lg overflow-hidden" style="height: 600px;">
                        <iframe src="https://lmarena.ai" class="w-full h-full" 
                            sandbox="allow-same-origin allow-scripts allow-popups allow-forms"
                            title="LMArena.ai"></iframe>
                    </div>
                </div>
            </div>

            <!-- Repositories Tab -->
            <div id="reposTab" class="tab-content hidden">
                <div class="flex gap-4 mb-4 flex-wrap">
                    <input type="text" id="repoFilter" placeholder="Filter repositories..." 
                        class="flex-1 min-w-64 bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:border-green-500">
                    <select id="repoSort" onchange="sortRepos()" class="bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none">
                        <option value="updated">Recently Updated</option>
                        <option value="name">Name</option>
                        <option value="stars">Stars</option>
                    </select>
                    <button onclick="loadRepositories()" class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg transition">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div id="reposList" class="grid gap-4 max-h-[600px] overflow-y-auto scrollbar-dark pr-2">
                    <p class="text-gray-400 text-center py-8">Loading repositories...</p>
                </div>
            </div>

            <!-- Create Repository Tab -->
            <div id="createTab" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="github-card rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4"><i class="fas fa-plus-circle mr-2 text-green-400"></i>Create New Repository</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-400 mb-2">Repository Name *</label>
                                <input type="text" id="newRepoName" placeholder="my-awesome-project" 
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:border-green-500">
                            </div>
                            <div>
                                <label class="block text-gray-400 mb-2">Description</label>
                                <textarea id="newRepoDesc" placeholder="A short description of your repository" 
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:border-green-500 h-24"></textarea>
                            </div>
                            <div class="flex items-center gap-4 flex-wrap">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="newRepoPrivate" class="w-4 h-4 accent-green-500">
                                    <span>Private repository</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="newRepoReadme" checked class="w-4 h-4 accent-green-500">
                                    <span>Initialize with README</span>
                                </label>
                            </div>
                            <button onclick="createRepository()" class="bg-green-600 hover:bg-green-700 px-6 py-2 rounded-lg font-medium transition">
                                <i class="fas fa-rocket mr-2"></i>Create Repository
                            </button>
                        </div>
                    </div>

                    <div class="lmarena-card rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4"><i class="fas fa-magic mr-2 text-purple-400"></i>AI-Generated Repository</h3>
                        <p class="text-gray-400 text-sm mb-4">Let AI create a complete repository structure for you based on a project description.</p>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-400 mb-2">Project Description *</label>
                                <textarea id="aiRepoDesc" placeholder="Describe your project... e.g., 'A React todo app with local storage persistence and dark mode support'" 
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:border-purple-500 h-24"></textarea>
                            </div>
                            <div>
                                <label class="block text-gray-400 mb-2">Repository Name</label>
                                <input type="text" id="aiRepoName" placeholder="ai-generated-repo" 
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:border-purple-500">
                            </div>
                            <button onclick="createAIRepository()" id="aiRepoBtn" class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded-lg font-medium transition">
                                <i class="fas fa-wand-magic-sparkles mr-2"></i>Generate & Create Repository
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Not Signed In State -->
        <div id="notSignedIn" class="github-card rounded-xl p-12 text-center">
            <div class="flex items-center justify-center gap-4 mb-6">
                <i class="fas fa-robot text-5xl text-purple-400"></i>
                <i class="fas fa-arrow-right text-2xl text-gray-500"></i>
                <i class="fab fa-github text-5xl text-gray-400"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2">LMArena + GitHub Integration</h2>
            <p class="text-gray-400 mb-6 max-w-lg mx-auto">Generate code using AI and push it directly to your GitHub repositories. Sign in with GitHub to get started.</p>
            <div class="flex gap-4 justify-center flex-wrap">
                <button onclick="signInWithGitHub()" class="bg-gray-800 hover:bg-gray-700 px-8 py-3 rounded-lg font-medium transition text-lg flex items-center gap-2 border border-gray-600">
                    <i class="fab fa-github text-xl"></i>Sign in with GitHub
                </button>
            </div>
            <p class="text-gray-500 text-sm mt-4">Powered by Puter.js</p>
        </div>

        <!-- Toast Notifications -->
        <div id="toast" class="fixed bottom-4 right-4 bg-gray-800 border border-gray-600 rounded-lg px-6 py-3 shadow-xl transform translate-y-20 opacity-0 transition-all duration-300 z-50">
            <span id="toastMessage"></span>
        </div>

        <!-- Push Success Modal -->
        <div id="successModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
            <div class="github-card rounded-xl p-8 max-w-md mx-4 text-center">
                <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-check text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">Success!</h3>
                <p id="successMessage" class="text-gray-400 mb-4"></p>
                <div class="flex gap-3 justify-center flex-wrap">
                    <button onclick="closeModal()" class="bg-gray-700 hover:bg-gray-600 px-6 py-2 rounded-lg transition">Close</button>
                    <a id="viewOnGithub" href="#" target="_blank" class="bg-green-600 hover:bg-green-700 px-6 py-2 rounded-lg transition flex items-center gap-2">
                        <i class="fab fa-github"></i>View on GitHub
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        let githubToken = null;
        let currentUser = null;
        let allRepos = [];
        let isGenerating = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            updateStatus('Ready to connect...', 'yellow');
            
            // Check if Puter is available
            if (typeof puter !== 'undefined') {
                document.getElementById('puterDot').className = 'w-2 h-2 rounded-full bg-green-500';
                
                // Check if already authenticated
                try {
                    const isSignedIn = puter.auth.isSignedIn();
                    if (isSignedIn) {
                        // Try to get stored token
                        const storedToken = await puter.kv.get('github_token');
                        if (storedToken) {
                            githubToken = storedToken;
                            await loadUserData();
                        }
                    }
                } catch (e) {
                    console.log('Init check:', e);
                }
            } else {
                document.getElementById('puterDot').className = 'w-2 h-2 rounded-full bg-red-500';
                updateStatus('Puter not available', 'red');
            }

            // Filter repos on input
            document.getElementById('repoFilter')?.addEventListener('input', filterRepos);
        });

        function updateStatus(text, color) {
            document.getElementById('statusText').textContent = text;
            const dot = document.getElementById('statusDot');
            dot.className = `w-3 h-3 rounded-full bg-${color}-500` + (color === 'yellow' ? ' pulse-dot' : '');
        }

        async function signInWithGitHub() {
            try {
                updateStatus('Connecting to GitHub...', 'yellow');
                const btn = document.getElementById('githubSignInBtn');
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Connecting...';
                
                // First ensure user is signed in to Puter
                const isSignedIn = puter.auth.isSignedIn();
                if (!isSignedIn) {
                    await puter.auth.signIn();
                }
                
                document.getElementById('puterDot').className = 'w-2 h-2 rounded-full bg-green-500';
                
                // Use GitHub OAuth popup
                // Since Puter doesn't have direct GitHub SSO, we'll use a popup-based OAuth flow
                const clientId = 'Ov23liUkpXzjNdE5I7g7'; // GitHub OAuth App Client ID - replace with yours or use generic
                const redirectUri = encodeURIComponent(window.location.origin + window.location.pathname);
                const scope = encodeURIComponent('repo user gist');
                const state = Math.random().toString(36).substring(7);
                
                // Store state for verification
                sessionStorage.setItem('github_oauth_state', state);
                
                // Check if we have a code in URL (OAuth callback)
                const urlParams = new URLSearchParams(window.location.search);
                const code = urlParams.get('code');
                const returnedState = urlParams.get('state');
                
                if (code && returnedState === sessionStorage.getItem('github_oauth_state')) {
                    // Exchange code for token - this would need a backend normally
                    // For demo, we'll ask for PAT since we can't do OAuth without backend
                    showTokenInput();
                    return;
                }
                
                // For now, show token input as GitHub OAuth requires a backend to exchange code
                // This is the most secure way without exposing client secret
                showTokenInput();
                
            } catch (error) {
                console.error('GitHub sign in error:', error);
                showToast('GitHub connection failed: ' + error.message, 'error');
                updateStatus('Connection failed', 'red');
                resetSignInButton();
            }
        }
        
        function showTokenInput() {
            const btn = document.getElementById('githubSignInBtn');
            btn.outerHTML = `
                <div id="tokenInputContainer" class="flex gap-2 items-center flex-wrap">
                    <input type="password" id="githubTokenInput" placeholder="GitHub Personal Access Token" 
                        class="bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-green-500 w-64">
                    <button onclick="submitToken()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg font-medium transition text-sm">
                        <i class="fas fa-check mr-1"></i>Connect
                    </button>
                    <a href="https://github.com/settings/tokens/new?scopes=repo,user,gist&description=LMArena+Puter+Integration" 
                       target="_blank" class="text-blue-400 hover:text-blue-300 text-sm">
                        <i class="fas fa-external-link-alt mr-1"></i>Get Token
                    </a>
                </div>
            `;
            document.getElementById('githubTokenInput').focus();
            updateStatus('Enter GitHub token (repo, user, gist scopes)', 'yellow');
        }
        
        async function submitToken() {
            const token = document.getElementById('githubTokenInput').value.trim();
            
            if (!token) {
                showToast('Please enter a token', 'error');
                return;
            }
            
            if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
                showToast('Invalid token format. Token should start with ghp_ or github_pat_', 'error');
                return;
            }
            
            try {
                updateStatus('Validating token...', 'yellow');
                
                // Validate the token
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Invalid token or insufficient permissions');
                }
                
                githubToken = token;
                
                // Store token in Puter KV for persistence
                try {
                    await puter.kv.set('github_token', token);
                } catch (e) {
                    // Fall back to localStorage if KV fails
                    localStorage.setItem('github_token_backup', token);
                }
                
                await loadUserData();
                
            } catch (error) {
                showToast('Failed to validate token: ' + error.message, 'error');
                updateStatus('Invalid token', 'red');
            }
        }
        
        function resetSignInButton() {
            const container = document.getElementById('tokenInputContainer');
            if (container) {
                container.outerHTML = `
                    <button id="githubSignInBtn" onclick="signInWithGitHub()" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded-lg font-medium transition flex items-center gap-2 border border-gray-600">
                        <i class="fab fa-github"></i> Sign in with GitHub
                    </button>
                `;
            }
        }

        async function loadUserData() {
            try {
                updateStatus('Loading GitHub data...', 'yellow');
                
                const userResponse = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `Bearer ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!userResponse.ok) {
                    throw new Error('Failed to fetch user data');
                }
                
                currentUser = await userResponse.json();
                displayUserProfile(currentUser);
                
                document.getElementById('githubDot').className = 'w-2 h-2 rounded-full bg-green-500';
                
                // Update auth section
                const authSection = document.getElementById('authSection');
                authSection.innerHTML = `
                    <div class="flex items-center gap-2 bg-gray-800 px-4 py-2 rounded-lg border border-green-600">
                        <img src="${currentUser.avatar_url}" class="w-6 h-6 rounded-full">
                        <span class="text-green-400">${currentUser.login}</span>
                        <button onclick="signOut()" class="ml-2 text-gray-400 hover:text-red-400 transition" title="Sign out">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                `;
                
                document.getElementById('mainContent').classList.remove('hidden');
                document.getElementById('notSignedIn').classList.add('hidden');
                
                await loadRepositories();
                
                updateStatus('Connected as ' + currentUser.login, 'green');
                showToast('Successfully connected to GitHub!', 'success');
            } catch (error) {
                console.error('Load user error:', error);
                githubToken = null;
                try {
                    await puter.kv.del('github_token');
                } catch (e) {}
                localStorage.removeItem('github_token_backup');
                updateStatus('Failed to load GitHub data', 'red');
                showToast('Failed to load GitHub data. Please try again.', 'error');
                resetSignInButton();
            }
        }
        
        async function signOut() {
            githubToken = null;
            currentUser = null;
            allRepos = [];
            
            try {
                await puter.kv.del('github_token');
            } catch (e) {}
            localStorage.removeItem('github_token_backup');
            
            document.getElementById('githubDot').className = 'w-2 h-2 rounded-full bg-gray-500';
            document.getElementById('mainContent').classList.add('hidden');
            document.getElementById('notSignedIn').classList.remove('hidden');
            
            document.getElementById('authSection').innerHTML = `
                <button id="githubSignInBtn" onclick="signInWithGitHub()" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded-lg font-medium transition flex items-center gap-2 border border-gray-600">
                    <i class="fab fa-github"></i> Sign in with GitHub
                </button>
            `;
            
            updateStatus('Signed out', 'yellow');
            showToast('Signed out successfully', 'success');
        }

        function displayUserProfile(user) {
            document.getElementById('userAvatar').src = user.avatar_url;
            document.getElementById('userName').textContent = user.name || user.login;
            document.getElementById('userLogin').textContent = '@' + user.login;
            document.getElementById('userBio').textContent = user.bio || '';
            document.getElementById('repoCount').textContent = user.public_repos;
            document.getElementById('followerCount').textContent = user.followers;
            document.getElementById('followingCount').textContent = user.following;
        }

        async function loadRepositories() {
            try {
                const response = await fetch('https://api.github.com/user/repos?per_page=100&sort=updated', {
                    headers: {
                        'Authorization': `Bearer ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!response.ok) throw new Error('Failed to fetch repositories');
                
                allRepos = await response.json();
                displayRepositories(allRepos);
                populateRepoDropdown(allRepos);
            } catch (error) {
                console.error('Load repos error:', error);
                showToast('Failed to load repositories', 'error');
            }
        }

        function populateRepoDropdown(repos) {
            const select = document.getElementById('targetRepo');
            select.innerHTML = '<option value="">Select repository...</option>' + 
                repos.map(repo => `<option value="${repo.full_name}" data-default-branch="${repo.default_branch}">${repo.name}${repo.private ? ' ðŸ”’' : ''}</option>`).join('');
            
            select.onchange = function() {
                const selected = this.options[this.selectedIndex];
                if (selected.dataset.defaultBranch) {
                    document.getElementById('targetBranch').value = selected.dataset.defaultBranch;
                }
            };
        }

        function displayRepositories(repos) {
            const container = document.getElementById('reposList');
            
            if (repos.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-center py-8">No repositories found</p>';
                return;
            }
            
            container.innerHTML = repos.map(repo => `
                <div class="github-card rounded-lg p-4 repo-card transition-all duration-200 cursor-pointer" onclick="window.open('${repo.html_url}', '_blank')">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1 flex-wrap">
                                <i class="fas fa-book text-gray-400"></i>
                                <span class="font-semibold text-blue-400 hover:underline">${repo.name}</span>
                                <span class="text-xs px-2 py-0.5 rounded-full ${repo.private ? 'bg-yellow-900 text-yellow-300' : 'bg-gray-700 text-gray-300'}">${repo.private ? 'Private' : 'Public'}</span>
                            </div>
                            <p class="text-gray-400 text-sm mb-2">${repo.description || 'No description'}</p>
                            <div class="flex items-center gap-4 text-sm text-gray-500 flex-wrap">
                                ${repo.language ? `<span class="flex items-center gap-1"><span class="w-3 h-3 rounded-full" style="background: ${getLanguageColor(repo.language)}"></span>${repo.language}</span>` : ''}
                                <span><i class="fas fa-star mr-1"></i>${repo.stargazers_count}</span>
                                <span><i class="fas fa-code-branch mr-1"></i>${repo.forks_count}</span>
                                <span>Updated ${timeAgo(repo.updated_at)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterRepos() {
            const query = document.getElementById('repoFilter').value.toLowerCase();
            const filtered = allRepos.filter(repo => 
                repo.name.toLowerCase().includes(query) || 
                (repo.description && repo.description.toLowerCase().includes(query))
            );
            displayRepositories(filtered);
        }

        function sortRepos() {
            const sortBy = document.getElementById('repoSort').value;
            let sorted = [...allRepos];
            
            switch(sortBy) {
                case 'name':
                    sorted.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'stars':
                    sorted.sort((a, b) => b.stargazers_count - a.stargazers_count);
                    break;
                case 'updated':
                default:
                    sorted.sort((a, b) => new Date(b.updated_at) - new Date(a.updated_at));
            }
            
            displayRepositories(sorted);
        }

        function toggleNewRepoSection() {
            const checked = document.getElementById('createNewRepo').checked;
            document.getElementById('newRepoSection').classList.toggle('hidden', !checked);
            document.getElementById('existingRepoSection').classList.toggle('hidden', checked);
        }

        // AI Code Generation using Puter AI
        function setPrompt(prompt) {
            document.getElementById('aiPrompt').value = prompt;
        }

        async function generateCode() {
            if (isGenerating) return;
            
            const prompt = document.getElementById('aiPrompt').value.trim();
            if (!prompt) {
                showToast('Please enter a prompt', 'error');
                return;
            }
            
            const model = document.getElementById('aiModel').value;
            const chatContainer = document.getElementById('chatMessages');
            const generateBtn = document.getElementById('generateBtn');
            
            isGenerating = true;
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Generating...</span>';
            
            // Add user message
            chatContainer.innerHTML += `
                <div class="user-message rounded-lg p-3 border border-green-700">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fas fa-user text-green-400"></i>
                        <span class="font-medium text-green-300">You</span>
                    </div>
                    <p class="text-gray-300 text-sm">${escapeHtml(prompt)}</p>
                </div>
            `;
            
            // Add typing indicator
            const typingId = 'typing-' + Date.now();
            chatContainer.innerHTML += `
                <div id="${typingId}" class="ai-message rounded-lg p-3 border border-purple-700">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-robot text-purple-400"></i>
                        <span class="font-medium text-purple-300">AI Assistant</span>
                        <span class="typing-indicator ml-2">
                            <span class="inline-block w-2 h-2 bg-purple-400 rounded-full"></span>
                            <span class="inline-block w-2 h-2 bg-purple-400 rounded-full ml-1"></span>
                            <span class="inline-block w-2 h-2 bg-purple-400 rounded-full ml-1"></span>
                        </span>
                    </div>
                </div>
            `;
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            try {
                const systemPrompt = `You are an expert programmer. Generate clean, well-commented, production-ready code based on the user's request. 
                Return ONLY the code without markdown code blocks or explanations. 
                Include appropriate comments in the code itself.
                At the very end of your response, on a new line, add: FILENAME: [suggested_filename]`;
                
                const response = await puter.ai.chat(systemPrompt + "\n\nUser request: " + prompt, { model: model });
                
                let code = response;
                let filename = 'generated-code.js';
                
                // Handle response object
                if (typeof response === 'object') {
                    if (response.message?.content) {
                        code = response.message.content;
                    } else if (response.text) {
                        code = response.text;
                    } else if (typeof response.toString === 'function') {
                        code = response.toString();
                    }
                }
                
                // Extract filename if present
                const filenameMatch = code.match(/FILENAME:\s*(.+)$/mi);
                if (filenameMatch) {
                    filename = filenameMatch[1].trim();
                    code = code.replace(/FILENAME:\s*.+$/mi, '').trim();
                }
                
                // Remove markdown code blocks if present
                code = code.replace(/^```[\w]*\n?/gm, '').replace(/\n?```$/gm, '').trim();
                
                // Remove typing indicator and add AI response
                const typingEl = document.getElementById(typingId);
                if (typingEl) typingEl.remove();
                
                chatContainer.innerHTML += `
                    <div class="ai-message rounded-lg p-3 border border-purple-700">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fas fa-robot text-purple-400"></i>
                            <span class="font-medium text-purple-300">AI Assistant</span>
                            <span class="text-xs text-gray-500">${model}</span>
                        </div>
                        <p class="text-gray-300 text-sm">âœ… Code generated! Check the editor on the right. Ready to push to GitHub.</p>
                    </div>
                `;
                
                // Update code editor
                document.getElementById('generatedCode').value = code;
                document.getElementById('codeFilename').value = filename;
                document.getElementById('commitMessage').value = `Add ${filename} - AI generated`;
                
                showToast('Code generated successfully!', 'success');
                
            } catch (error) {
                console.error('AI generation error:', error);
                const typingEl = document.getElementById(typingId);
                if (typingEl) typingEl.remove();
                
                chatContainer.innerHTML += `
                    <div class="ai-message rounded-lg p-3 border border-red-700 bg-red-900/20">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fas fa-exclamation-circle text-red-400"></i>
                            <span class="font-medium text-red-300">Error</span>
                        </div>
                        <p class="text-gray-300 text-sm">Failed to generate code: ${error.message}</p>
                    </div>
                `;
                showToast('Failed to generate code', 'error');
            }
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
            document.getElementById('aiPrompt').value = '';
            isGenerating = false;
            generateBtn.disabled = false;
            generateBtn.innerHTML = '<i class="fas fa-magic"></i><span>Generate</span>';
        }

        async function pushToGitHub() {
            if (!githubToken) {
                showToast('Please connect to GitHub first', 'error');
                return;
            }
            
            const createNew = document.getElementById('createNewRepo').checked;
            let repo, branch;
            
            if (createNew) {
                const repoName = document.getElementById('newRepoNameForPush').value.trim();
                const repoDesc = document.getElementById('newRepoDescForPush').value.trim();
                const isPrivate = document.getElementById('newRepoPrivateForPush').checked;
                
                if (!repoName) {
                    showToast('Please enter a repository name', 'error');
                    return;
                }
                
                try {
                    showToast('Creating repository...', 'info');
                    
                    const createResponse = await fetch('https://api.github.com/user/repos', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${githubToken}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            name: repoName,
                            description: repoDesc,
                            private: isPrivate,
                            auto_init: true
                        })
                    });
                    
                    if (!createResponse.ok) {
                        const error = await createResponse.json();
                        throw new Error(error.message || 'Failed to create repository');
                    }
                    
                    const newRepo = await createResponse.json();
                    repo = newRepo.full_name;
                    branch = newRepo.default_branch;
                    
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                } catch (error) {
                    showToast('Failed to create repository: ' + error.message, 'error');
                    return;
                }
            } else {
                repo = document.getElementById('targetRepo').value;
                branch = document.getElementById('targetBranch').value.trim() || 'main';
                
                if (!repo) {
                    showToast('Please select a repository', 'error');
                    return;
                }
            }
            
            const filePath = document.getElementById('filePath').value.trim();
            const filename = document.getElementById('codeFilename').value.trim();
            const code = document.getElementById('generatedCode').value;
            const commitMessage = document.getElementById('commitMessage').value.trim() || 'Add file via LMArena';
            
            if (!filename) {
                showToast('Please enter a filename', 'error');
                return;
            }
            if (!code) {
                showToast('No code to push', 'error');
                return;
            }
            
            const pushBtn = document.getElementById('pushBtn');
            pushBtn.disabled = true;
            pushBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Pushing...';
            
            try {
                const fullPath = filePath ? `${filePath.replace(/\/$/, '')}/${filename}` : filename;
                
                let sha = null;
                try {
                    const existingFile = await fetch(`https://api.github.com/repos/${repo}/contents/${fullPath}?ref=${branch}`, {
                        headers: {
                            'Authorization': `Bearer ${githubToken}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    if (existingFile.ok) {
                        const fileData = await existingFile.json();
                        sha = fileData.sha;
                    }
                } catch (e) {}
                
                const response = await fetch(`https://api.github.com/repos/${repo}/contents/${fullPath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: commitMessage,
                        content: btoa(unescape(encodeURIComponent(code))),
                        branch: branch,
                        ...(sha && { sha })
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Failed to push to GitHub');
                }
                
                const result = await response.json();
                
                if (createNew) {
                    await loadRepositories();
                }
                
                document.getElementById('successMessage').textContent = `${filename} has been pushed to ${repo}/${branch}`;
                document.getElementById('viewOnGithub').href = result.content.html_url;
                document.getElementById('successModal').classList.remove('hidden');
                
                showToast('Code pushed to GitHub!', 'success');
                
            } catch (error) {
                console.error('Push error:', error);
                showToast('Failed to push: ' + error.message, 'error');
            }
            
            pushBtn.disabled = false;
            pushBtn.innerHTML = '<i class="fas fa-upload"></i>Push to GitHub';
        }

        async function createRepository() {
            if (!githubToken) {
                showToast('Please connect to GitHub first', 'error');
                return;
            }
            
            const name = document.getElementById('newRepoName').value.trim();
            const description = document.getElementById('newRepoDesc').value.trim();
            const isPrivate = document.getElementById('newRepoPrivate').checked;
            const autoInit = document.getElementById('newRepoReadme').checked;
            
            if (!name) {
                showToast('Repository name is required', 'error');
                return;
            }
            
            try {
                const response = await fetch('https://api.github.com/user/repos', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        description,
                        private: isPrivate,
                        auto_init: autoInit
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Failed to create repository');
                }
                
                const repo = await response.json();
                
                document.getElementById('successMessage').textContent = `Repository "${repo.name}" created successfully!`;
                document.getElementById('viewOnGithub').href = repo.html_url;
                document.getElementById('successModal').classList.remove('hidden');
                
                document.getElementById('newRepoName').value = '';
                document.getElementById('newRepoDesc').value = '';
                
                await loadRepositories();
            } catch (error) {
                console.error('Create repo error:', error);
                showToast('Failed to create repository: ' + error.message, 'error');
            }
        }

        async function createAIRepository() {
            if (!githubToken) {
                showToast('Please connect to GitHub first', 'error');
                return;
            }
            
            const description = document.getElementById('aiRepoDesc').value.trim();
            const repoName = document.getElementById('aiRepoName').value.trim() || 'ai-generated-' + Date.now();
            
            if (!description) {
                showToast('Please describe your project', 'error');
                return;
            }
            
            const btn = document.getElementById('aiRepoBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            
            try {
                const prompt = `Create a project structure for: ${description}

Generate:
1. A comprehensive README.md with project description, features, installation, and usage
2. The main code file for the project

Format your response as:
---README.md---
[README content]
---MAIN_FILE:[filename]---
[code content]`;

                const response = await puter.ai.chat(prompt, { model: 'gpt-4o' });
                
                let content = typeof response === 'string' ? response : (response.message?.content || response.text || response.toString());
                
                const readmeMatch = content.match(/---README\.md---\s*([\s\S]*?)(?=---MAIN_FILE:|$)/);
                const mainFileMatch = content.match(/---MAIN_FILE:(.+?)---\s*([\s\S]*?)$/);
                
                const readme = readmeMatch ? readmeMatch[1].trim() : `# ${repoName}\n\n${description}`;
                const mainFilename = mainFileMatch ? mainFileMatch[1].trim() : 'index.js';
                const mainCode = mainFileMatch ? mainFileMatch[2].trim() : '// TODO: Add code';
                
                const createResponse = await fetch('https://api.github.com/user/repos', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: repoName,
                        description: description.substring(0, 100),
                        auto_init: true
                    })
                });
                
                if (!createResponse.ok) {
                    const error = await createResponse.json();
                    throw new Error(error.message);
                }
                
                const repo = await createResponse.json();
                
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const readmeResponse = await fetch(`https://api.github.com/repos/${repo.full_name}/contents/README.md`, {
                    headers: {
                        'Authorization': `Bearer ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (readmeResponse.ok) {
                    const readmeData = await readmeResponse.json();
                    await fetch(`https://api.github.com/repos/${repo.full_name}/contents/README.md`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${githubToken}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: 'Update README with AI-generated content',
                            content: btoa(unescape(encodeURIComponent(readme))),
                            sha: readmeData.sha
                        })
                    });
                }
                
                await fetch(`https://api.github.com/repos/${repo.full_name}/contents/${mainFilename}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Add main file - AI generated',
                        content: btoa(unescape(encodeURIComponent(mainCode)))
                    })
                });
                
                document.getElementById('successMessage').textContent = `AI-generated repository "${repo.name}" created with README and ${mainFilename}!`;
                document.getElementById('viewOnGithub').href = repo.html_url;
                document.getElementById('successModal').classList.remove('hidden');
                
                document.getElementById('aiRepoDesc').value = '';
                document.getElementById('aiRepoName').value = '';
                
                await loadRepositories();
                
            } catch (error) {
                console.error('AI repo creation error:', error);
                showToast('Failed: ' + error.message, 'error');
            }
            
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-wand-magic-sparkles mr-2"></i>Generate & Create Repository';
        }

        function captureFromLMArena() {
            showToast('Paste code from LMArena in the import section below the iframe', 'info');
            document.getElementById('lmarenaCodeImport').focus();
        }

        function importLMArenaCode() {
            const code = document.getElementById('lmarenaCodeImport').value.trim();
            const filename = document.getElementById('lmarenaFilename').value.trim() || 'imported-code.js';
            
            if (!code) {
                showToast('Please paste some code to import', 'error');
                return;
            }
            
            document.getElementById('generatedCode').value = code;
            document.getElementById('codeFilename').value = filename;
            document.getElementById('commitMessage').value = `Add ${filename} - imported from LMArena`;
            
            switchTab('lmarena');
            showToast('Code imported! Ready to push to GitHub.', 'success');
        }

        function closeModal() {
            document.getElementById('successModal').classList.add('hidden');
        }

        function copyCode() {
            const code = document.getElementById('generatedCode').value;
            if (code) {
                navigator.clipboard.writeText(code);
                showToast('Code copied to clipboard!', 'success');
            }
        }

        function clearCode() {
            document.getElementById('generatedCode').value = '';
            document.getElementById('codeFilename').value = '';
            document.getElementById('commitMessage').value = '';
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-green-600', 'bg-purple-600');
                btn.classList.add('bg-gray-700', 'hover:bg-gray-600');
            });
            
            const activeBtn = document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1));
            if (activeBtn) {
                activeBtn.classList.remove('bg-gray-700', 'hover:bg-gray-600');
                activeBtn.classList.add(tab.includes('lmarena') ? 'bg-purple-600' : 'bg-green-600');
            }
            
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            const tabContent = document.getElementById(tab + 'Tab');
            if (tabContent) tabContent.classList.remove('hidden');
        }

        function getLanguageColor(language) {
            const colors = {
                'JavaScript': '#f1e05a',
                'TypeScript': '#2b7489',
                'Python': '#3572A5',
                'Java': '#b07219',
                'C++': '#f34b7d',
                'C': '#555555',
                'C#': '#239120',
                'Go': '#00ADD8',
                'Rust': '#dea584',
                'Ruby': '#701516',
                'PHP': '#4F5D95',
                'Swift': '#ffac45',
                'Kotlin': '#F18E33',
                'HTML': '#e34c26',
                'CSS': '#1572B6',
                'Vue': '#41b883'
            };
            return colors[language] || '#8b949e';
        }

        function timeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);
            
            const intervals = {
                year: 31536000,
                month: 2592000,
                week: 604800,
                day: 86400,
                hour: 3600,
                minute: 60
            };
            
            for (const [unit, secondsInUnit] of Object.entries(intervals)) {
                const interval = Math.floor(seconds / secondsInUnit);
                if (interval >= 1) {
                    return `${interval} ${unit}${interval > 1 ? 's' : ''} ago`;
                }
            }
            
            return 'just now';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.className = `fixed bottom-4 right-4 rounded-lg px-6 py-3 shadow-xl transition-all duration-300 z-50 ${
                type === 'success' ? 'bg-green-800 border border-green-600' :
                type === 'error' ? 'bg-red-800 border border-red-600' :
                'bg-gray-800 border border-gray-600'
            }`;
            
            toast.classList.remove('translate-y-20', 'opacity-0');
            
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }
    </script>
</body>
</html>
